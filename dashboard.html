<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobRadar Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f7; color: #1d1d1f; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: white; padding: 30px 0; margin-bottom: 30px; border-bottom: 1px solid #e5e5e5; }
        h1 { font-size: 2.5em; font-weight: 700; margin-bottom: 10px; }
        .stats { display: flex; gap: 30px; margin-top: 20px; flex-wrap: wrap; }
        .stat { background: #f5f5f7; padding: 15px 25px; border-radius: 12px; }
        .stat-value { font-size: 2em; font-weight: 700; color: #0066cc; }
        .stat-label { font-size: 0.9em; color: #6e6e73; margin-top: 5px; }
        .filters { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        .filter-row { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-start; margin-bottom: 15px; }
        .filter-row:last-child { margin-bottom: 0; }
        input, select, textarea { padding: 10px 15px; border: 1px solid #d2d2d7; border-radius: 8px; font-size: 1em; font-family: inherit; }
        input, select { flex: 1; min-width: 200px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #0066cc; }
        .toggle-switch { display: flex; align-items: center; gap: 10px; padding: 10px 15px; background: #f5f5f7; border-radius: 8px; cursor: pointer; user-select: none; }
        .toggle-switch input[type="checkbox"] { min-width: auto; width: 20px; height: 20px; cursor: pointer; }
        .toggle-switch label { cursor: pointer; font-weight: 500; }
        button { background: #0066cc; color: white; border: none; padding: 10px 25px; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 500; }
        button:hover { background: #0055b3; }
        button:disabled { background: #d2d2d7; cursor: not-allowed; }
        .btn-secondary { background: #f5f5f7; color: #1d1d1f; }
        .btn-secondary:hover { background: #e5e5e5; }
        .btn-small { padding: 6px 12px; font-size: 0.85em; min-width: auto; }
        .btn-interested { background: #0066cc; }
        .btn-applied { background: #34c759; }
        .btn-interviewing { background: #ff9500; }
        .btn-rejected { background: #ff3b30; }
        .btn-offer { background: #af52de; }
        .jobs-grid { display: grid; gap: 15px; }
        .job-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #e5e5e5; cursor: pointer; transition: all 0.2s; position: relative; }
        .job-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .job-card.new { border-left: 4px solid #34c759; }
        .job-card.relevant { border-left: 4px solid #ff9500; }
        .job-card.status-interested { border-left: 4px solid #0066cc; }
        .job-card.status-applied { border-left: 4px solid #34c759; }
        .job-card.status-interviewing { border-left: 4px solid #ff9500; }
        .job-card.status-rejected { border-left: 4px solid #ff3b30; opacity: 0.6; }
        .job-card.status-offer { border-left: 4px solid #af52de; }
        .job-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .job-title { font-size: 1.3em; font-weight: 600; color: #1d1d1f; margin-bottom: 8px; }
        .job-company { color: #0066cc; font-weight: 500; margin-bottom: 5px; }
        .job-salary { color: #34c759; font-weight: 600; font-size: 1.1em; margin-top: 8px; }
        .job-meta { display: flex; gap: 20px; color: #6e6e73; font-size: 0.9em; flex-wrap: wrap; margin-bottom: 12px; }
        .job-meta span { display: flex; align-items: center; gap: 5px; }
        .job-status-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
        .job-comment { font-size: 0.9em; color: #6e6e73; font-style: italic; margin-top: 10px; padding-top: 10px; border-top: 1px solid #f5f5f7; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 6px; font-size: 0.85em; font-weight: 500; }
        .badge-new { background: #34c759; color: white; }
        .badge-relevant { background: #ff9500; color: white; }
        .badge-source { background: #f5f5f7; color: #6e6e73; }
        .badge-status { text-transform: uppercase; font-weight: 600; }
        .badge-interested { background: #0066cc; color: white; }
        .badge-applied { background: #34c759; color: white; }
        .badge-interviewing { background: #ff9500; color: white; }
        .badge-rejected { background: #ff3b30; color: white; }
        .badge-offer { background: #af52de; color: white; }
        .loading { text-align: center; padding: 60px; color: #6e6e73; font-size: 1.2em; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; max-width: 800px; margin: 50px auto; padding: 40px; border-radius: 12px; position: relative; }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 2em; cursor: pointer; color: #6e6e73; }
        .modal-close:hover { color: #1d1d1f; }
        .job-description { margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e5e5; white-space: pre-wrap; line-height: 1.8; }
        .status-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e5e5; }
        .status-section h3 { margin-bottom: 15px; }
        .comment-box { width: 100%; min-height: 100px; margin-top: 10px; padding: 10px; }
        .action-buttons { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .status-filter { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ JobRadar Dashboard</h1>
            <div class="stats">
                <div class="stat"><div class="stat-value" id="total-jobs">-</div><div class="stat-label">Total Jobs</div></div>
                <div class="stat"><div class="stat-value" id="relevant-jobs">-</div><div class="stat-label">Relevant Jobs</div></div>
                <div class="stat"><div class="stat-value" id="new-jobs">-</div><div class="stat-label">New (7 days)</div></div>
                <div class="stat"><div class="stat-value" id="interested-count">-</div><div class="stat-label">Interested</div></div>
                <div class="stat"><div class="stat-value" id="applied-count">-</div><div class="stat-label">Applied</div></div>
                <div class="stat"><div class="stat-value" id="interviewing-count">-</div><div class="stat-label">Interviewing</div></div>
            </div>
        </header>
        
        <div class="filters">
            <div class="filter-row">
                <input type="text" id="search" placeholder="Search by title or keywords...">
                <select id="recency-filter"><option value="">All Jobs</option><option value="7">Last 7 days</option><option value="14">Last 14 days</option><option value="30">Last 30 days</option></select>
                <div class="toggle-switch"><input type="checkbox" id="relevant-only" checked><label for="relevant-only">Show Relevant Only</label></div>
            </div>
            <div class="filter-row">
                <div style="flex: 1; min-width: 200px;"><label style="font-size: 0.9em; color: #6e6e73; display: block; margin-bottom: 5px;">Status Filter</label>
                    <select id="status-filter">
                        <option value="">All Statuses</option>
                        <option value="untracked">Not Yet Reviewed</option>
                        <option value="interested">Interested</option>
                        <option value="applied">Applied</option>
                        <option value="interviewing">Interviewing</option>
                        <option value="rejected">Rejected</option>
                        <option value="offer">Offer</option>
                    </select>
                </div>
                <button onclick="clearFilters()" class="btn-secondary">Clear Filters</button>
                <button onclick="loadJobs()">Refresh</button>
            </div>
        </div>
        
        <div class="jobs-grid" id="jobs-container"><div class="loading">Loading jobs...</div></div>
    </div>
    
    <div class="modal" id="job-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://cvgdclbpgpuntooszlol.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2Z2RjbGJwZ3B1bnRvb3N6bG9sIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTEzNTg1NywiZXhwIjoyMDg2NzExODU3fQ.2nXeNwVbQYEHWhKXrm2eF9hFYY3T1rQuanPvk2uDYH4';
        const { createClient } = supabase;
        const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let allJobs = [];
        const ROLE_KEYWORDS = ["chief information", "chief technology", "chief digital", "chief data", "chief innovation", "cio", "cto", "cdo", "cdao", "chief", "director", "program director", "programme director", "project director", "vice president", "vp technology", "vp engineering", "head of technology", "head of digital", "head of it", "head of data", "head of engineering", "head of transformation", "general manager", " gm ", "gm technology", "senior manager technology", "senior manager it", "senior program manager", "senior project manager", "principal engineer", "principal architect", "program manager", "programme manager", "transformation", "technology", "digital", "enterprise architecture"];
        const AU_LOCATIONS = ["australia", "melbourne", "sydney", "brisbane", "perth", "adelaide", "canberra", "remote", "au", "nsw", "vic", "qld", "wa", "sa", "act"];
        
        function isRelevant(job) {
            const title = (job.title || "").toLowerCase();
            const location = (job.location || "").toLowerCase();
            return ROLE_KEYWORDS.some(k => title.includes(k)) && (AU_LOCATIONS.some(l => location.includes(l)) || location === "");
        }
        
        async function loadJobs() {
            try {
                const { data, error } = await client.from('jobs').select('*').eq('is_active', true).order('created_at', { ascending: false });
                if (error) throw error;
                allJobs = (data || []).map(job => ({ ...job, isRelevant: isRelevant(job) }));
                updateStats();
                filterJobs();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('jobs-container').innerHTML = '<div class="loading">Error loading jobs</div>';
            }
        }
        
        function updateStats() {
            const sevenDaysAgo = new Date(); sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            document.getElementById('total-jobs').textContent = allJobs.length;
            document.getElementById('relevant-jobs').textContent = allJobs.filter(j => j.isRelevant).length;
            document.getElementById('new-jobs').textContent = allJobs.filter(j => new Date(j.created_at) > sevenDaysAgo).length;
            document.getElementById('interested-count').textContent = allJobs.filter(j => j.status === 'interested').length;
            document.getElementById('applied-count').textContent = allJobs.filter(j => j.status === 'applied').length;
            document.getElementById('interviewing-count').textContent = allJobs.filter(j => j.status === 'interviewing').length;
        }
        
        function filterJobs() {
            const search = document.getElementById('search').value.toLowerCase();
            const recency = document.getElementById('recency-filter').value;
            const relevantOnly = document.getElementById('relevant-only').checked;
            const statusFilter = document.getElementById('status-filter').value;
            
            let filtered = allJobs;
            if (relevantOnly) filtered = filtered.filter(j => j.isRelevant);
            if (search) filtered = filtered.filter(j => j.title.toLowerCase().includes(search) || (j.description && j.description.toLowerCase().includes(search)));
            if (statusFilter === 'untracked') filtered = filtered.filter(j => !j.status);
            else if (statusFilter) filtered = filtered.filter(j => j.status === statusFilter);
            if (recency) { const daysAgo = new Date(); daysAgo.setDate(daysAgo.getDate() - parseInt(recency)); filtered = filtered.filter(j => new Date(j.created_at) > daysAgo); }
            
            displayJobs(filtered);
        }
        
        function displayJobs(jobs) {
            const container = document.getElementById('jobs-container');
            if (jobs.length === 0) { container.innerHTML = '<div class="loading">No jobs found</div>'; return; }
            
            const sevenDaysAgo = new Date(); sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            container.innerHTML = jobs.map(job => {
                const isNew = new Date(job.created_at) > sevenDaysAgo;
                const posted = new Date(job.created_at).toLocaleDateString();
                const statusClass = job.status ? `status-${job.status}` : '';
                return `
                    <div class="job-card ${isNew ? 'new' : ''} ${job.isRelevant ? 'relevant' : ''} ${statusClass}">
                        <div onclick="showJobDetail('${job.id}')" style="cursor: pointer;">
                            <div class="job-header">
                                <div style="flex: 1;"><div class="job-title">${job.title}</div><div class="job-company">${job.company}</div></div>
                                <div style="display: flex; gap: 5px; flex-direction: column; align-items: flex-end;">
                                    ${isNew ? '<span class="badge badge-new">NEW</span>' : ''}
                                    ${job.isRelevant ? '<span class="badge badge-relevant">RELEVANT</span>' : ''}
                                    ${job.status ? `<span class="badge badge-status badge-${job.status}">${job.status}</span>` : ''}
                                </div>
                            </div>
                            <div class="job-meta">
                                <span>üìç ${job.location || 'Location not specified'}</span>
                                <span>üìÖ ${posted}</span>
                                <span class="badge badge-source">${job.source}</span>
                            </div>
                        </div>
                        <div class="job-status-buttons" onclick="event.stopPropagation();">
                            <button class="btn-small btn-interested" onclick="updateStatus('${job.id}', 'interested')">Interested</button>
                            <button class="btn-small btn-applied" onclick="updateStatus('${job.id}', 'applied')">Applied</button>
                            <button class="btn-small btn-interviewing" onclick="updateStatus('${job.id}', 'interviewing')">Interviewing</button>
                            <button class="btn-small btn-rejected" onclick="updateStatus('${job.id}', 'rejected')">Rejected</button>
                            ${job.status ? '<button class="btn-small btn-secondary" onclick="updateStatus(\'' + job.id + '\', null)">Clear</button>' : ''}
                        </div>
                        ${job.comments ? `<div class="job-comment">üí¨ ${job.comments}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        async function updateStatus(jobId, status) {
            try {
                const { error } = await client.from('jobs').update({ status: status, status_updated_at: new Date().toISOString() }).eq('id', jobId);
                if (error) throw error;
                const job = allJobs.find(j => j.id === jobId);
                if (job) job.status = status;
                updateStats();
                filterJobs();
            } catch (error) {
                alert('Error updating status: ' + error.message);
            }
        }
        
        async function updateComments(jobId, comments) {
            try {
                const { error } = await client.from('jobs').update({ comments: comments }).eq('id', jobId);
                if (error) throw error;
                const job = allJobs.find(j => j.id === jobId);
                if (job) job.comments = comments;
                filterJobs();
            } catch (error) {
                alert('Error saving comments: ' + error.message);
            }
        }
        
        function showJobDetail(jobId) {
            const job = allJobs.find(j => j.id === jobId);
            if (!job) return;
            document.getElementById('modal-body').innerHTML = `
                <h2>${job.title}</h2>
                <div class="job-company" style="font-size: 1.2em; margin: 10px 0;">${job.company}</div>
                <div class="job-meta" style="margin-top: 10px;">
                    <span>üìç ${job.location || 'Not specified'}</span>
                    <span>üìÖ Posted ${new Date(job.created_at).toLocaleDateString()}</span>
                    <span class="badge badge-source">${job.source}</span>
                    ${job.status ? `<span class="badge badge-status badge-${job.status}">${job.status}</span>` : ''}
                </div>
                <div class="job-description">${job.description || 'No description available'}</div>
                <div class="status-section">
                    <h3>Job Status</h3>
                    <div class="job-status-buttons">
                        <button class="btn-interested" onclick="updateStatus('${job.id}', 'interested'); closeModal();">Interested</button>
                        <button class="btn-applied" onclick="updateStatus('${job.id}', 'applied'); closeModal();">Applied</button>
                        <button class="btn-interviewing" onclick="updateStatus('${job.id}', 'interviewing'); closeModal();">Interviewing</button>
                        <button class="btn-rejected" onclick="updateStatus('${job.id}', 'rejected'); closeModal();">Rejected</button>
                        <button class="btn-offer" onclick="updateStatus('${job.id}', 'offer'); closeModal();">Offer</button>
                        ${job.status ? '<button class="btn-secondary" onclick="updateStatus(\'' + job.id + '\', null); closeModal();">Clear Status</button>' : ''}
                    </div>
                    <h3 style="margin-top: 20px;">Notes</h3>
                    <textarea class="comment-box" id="comment-input" placeholder="Add your notes here...">${job.comments || ''}</textarea>
                    <button onclick="updateComments('${job.id}', document.getElementById('comment-input').value); alert('Comments saved!');" style="margin-top: 10px;">Save Comments</button>
                </div>
                <div class="action-buttons">
                    <button onclick="window.open('${job.url}', '_blank')">View Job ‚Üí</button>
                    <button class="btn-secondary" onclick="closeModal()">Close</button>
                </div>
            `;
            document.getElementById('job-modal').style.display = 'block';
        }
        
        function closeModal() { document.getElementById('job-modal').style.display = 'none'; }
        function clearFilters() { document.getElementById('search').value = ''; document.getElementById('recency-filter').value = ''; document.getElementById('status-filter').value = ''; document.getElementById('relevant-only').checked = true; filterJobs(); }
        
        document.getElementById('search').addEventListener('input', filterJobs);
        document.getElementById('recency-filter').addEventListener('change', filterJobs);
        document.getElementById('status-filter').addEventListener('change', filterJobs);
        document.getElementById('relevant-only').addEventListener('change', filterJobs);
        window.onclick = function(event) { if (event.target === document.getElementById('job-modal')) closeModal(); }
        
        loadJobs();
    </script>
</body>
</html>
